<!doctype html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simulador de Cr√©dito</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.2em;
        opacity: 0.9;
      }

      .content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0;
      }

      .input-section {
        padding: 40px;
        background: #f8f9fa;
      }

      .results-section {
        padding: 40px;
        background: white;
      }

      .section-title {
        font-size: 1.8em;
        color: #2c3e50;
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .form-group {
        margin-bottom: 25px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #34495e;
        font-size: 1.1em;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 15px;
        border: 2px solid #e1e8ed;
        border-radius: 10px;
        font-size: 1.1em;
        transition: all 0.3s ease;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
      }

      .parameter-section {
        background: linear-gradient(135deg, #e8f4fd, #d6eaf8);
        border: 2px solid #3498db;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 25px;
      }

      .parameter-title {
        font-size: 1.2em;
        color: #2980b9;
        margin-bottom: 15px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .btn-calculate {
        width: 100%;
        padding: 18px;
        background: linear-gradient(135deg, #27ae60, #2ecc71);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 1.2em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 20px;
      }

      .btn-calculate:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(39, 174, 96, 0.3);
      }

      .result-card {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        border-left: 5px solid #3498db;
        transition: all 0.3s ease;
      }

      .result-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      }

      .result-card.warning {
        border-left-color: #e74c3c;
        background: linear-gradient(135deg, #ffebee, #ffcdd2);
      }

      .result-card.success {
        border-left-color: #27ae60;
        background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
      }

      .result-label {
        font-size: 1.1em;
        color: #7f8c8d;
        margin-bottom: 8px;
      }

      .result-value {
        font-size: 1.8em;
        font-weight: 700;
        color: #2c3e50;
      }

      .result-formula {
        font-size: 0.9em;
        color: #95a5a6;
        font-family: 'Courier New', monospace;
        margin-top: 5px;
      }

      .alert {
        padding: 15px;
        border-radius: 10px;
        margin-top: 20px;
        display: none;
        font-weight: 600;
      }

      .alert.show {
        display: block;
      }

      .alert.danger {
        background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        color: white;
      }

      .alert.warning {
        background: linear-gradient(135deg, #f39c12, #e67e22);
        color: white;
      }

      .alert.success {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        color: white;
      }

      .summary-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 30px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .summary-table th {
        background: linear-gradient(135deg, #34495e, #2c3e50);
        color: white;
        padding: 15px;
        text-align: left;
        font-weight: 600;
      }

      .summary-table td {
        padding: 15px;
        border-bottom: 1px solid #ecf0f1;
        background: white;
      }

      .summary-table tr:nth-child(even) td {
        background: #f8f9fa;
      }

      .status-indicator {
        display: inline-block;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: 600;
        margin-left: 10px;
      }

      .status-approved {
        background: #d4edda;
        color: #155724;
      }

      .status-review {
        background: #fff3cd;
        color: #856404;
      }

      .status-rejected {
        background: #f8d7da;
        color: #721c24;
      }

      @media (max-width: 768px) {
        .content {
          grid-template-columns: 1fr;
        }

        .header h1 {
          font-size: 2em;
        }

        .input-section,
        .results-section {
          padding: 20px;
        }
      }

      .icon {
        font-size: 1.2em;
      }

      .info-text {
        font-size: 0.9em;
        color: #7f8c8d;
        font-style: italic;
        margin-top: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üí∞ Simulador de Cr√©dito</h1>
        <p>
          Calcule sua presta√ß√£o, taxa de esfor√ßo e TAEG de forma simples e
          r√°pida
        </p>
      </div>

      <div class="content">
        <div class="input-section">
          <h2 class="section-title">
            <span class="icon">üìä</span>
            Dados do Cr√©dito
          </h2>

          <div class="form-group">
            <label for="rendimento">Rendimento Mensal L√≠quido (CVE)</label>
            <input
              type="number"
              id="rendimento"
              placeholder="Ex: 73524"
              value="73524"
            />
          </div>

          <div class="form-group">
            <label for="montante">Montante de Cr√©dito(CVE)</label>
            <input
              type="number"
              id="montante"
              placeholder="Ex: 5000000"
              value="5000000"
            />
          </div>

          <div class="form-group">
            <label for="taxa">Taxa de Juro Anual (%)</label>
            <input
              type="number"
              id="taxa"
              step="0.1"
              placeholder="Ex: 7.5"
              value="7.5"
            />
          </div>

          <div class="form-group">
            <label for="prazo">Prazo (meses)</label>
            <input type="number" id="prazo" placeholder="Ex: 420" value="420" />
          </div>

          <div class="form-group">
            <label for="comissao">Comiss√£o (%)</label>
            <input
              type="number"
              id="comissao"
              step="0.1"
              placeholder="Ex: 2"
              value="2"
            />
          </div>

          <div class="parameter-section">
            <div class="parameter-title">
              <span class="icon">‚öôÔ∏è</span>
              Par√¢metros Banc√°rios
            </div>

            <div class="form-group">
              <label for="limiteTaxaEsforco">Limite Taxa de Esfor√ßo (%)</label>
              <select id="limiteTaxaEsforco">
                <option value="30">30% - Conservador</option>
                <option value="35" selected>35% - Padr√£o Banc√°rio</option>
                <option value="40">40% - Flex√≠vel</option>
                <option value="50">50% - M√°ximo Legal</option>
                <option value="custom">Personalizado</option>
              </select>
              <div class="info-text">
                A maioria dos bancos usa 30-35% como limite m√°ximo
              </div>
            </div>

            <div class="form-group" id="customLimitGroup" style="display: none">
              <label for="customLimit">Taxa Personalizada (%)</label>
              <input
                type="number"
                id="customLimit"
                min="1"
                max="100"
                step="0.1"
                placeholder="Ex: 32.5"
              />
            </div>
          </div>

          <button class="btn-calculate" onclick="calcular()">
            üßÆ Calcular Simula√ß√£o
          </button>

          <div id="alertDanger" class="alert danger">
            üö´ <strong>Cr√©dito Rejeitado:</strong> Taxa de esfor√ßo muito elevada
            para aprova√ß√£o banc√°ria.
          </div>

          <div id="alertWarning" class="alert warning">
            ‚ö†Ô∏è <strong>An√°lise Necess√°ria:</strong> Taxa de esfor√ßo no limite.
            Aprova√ß√£o sujeita a an√°lise adicional.
          </div>

          <div id="alertSuccess" class="alert success">
            ‚úÖ <strong>Pr√©-Aprovado:</strong> Taxa de esfor√ßo dentro dos
            par√¢metros banc√°rios recomendados.
          </div>
        </div>

        <div class="results-section">
          <h2 class="section-title">
            <span class="icon">üìà</span>
            Resultados da Simula√ß√£o
          </h2>

          <div class="result-card">
            <div class="result-label">Taxa Mensal</div>
            <div class="result-value" id="taxaMensal">-</div>
            <div class="result-formula">Taxa Anual √∑ 12</div>
          </div>

          <div class="result-card">
            <div class="result-label">Presta√ß√£o Mensal</div>
            <div class="result-value" id="prestacao">-</div>
            <div class="result-formula">
              PGTO(taxa_mensal; prazo; -montante)
            </div>
          </div>

          <div class="result-card" id="taxaEsforcoCard">
            <div class="result-label">
              Taxa de Esfor√ßo <span id="statusIndicator"></span>
            </div>
            <div class="result-value" id="taxaEsforco">-</div>
            <div class="result-formula">
              Presta√ß√£o √∑ Rendimento (Limite: <span id="limiteAtual">35</span>%)
            </div>
          </div>

          <div class="result-card">
            <div class="result-label">TAEG</div>
            <div class="result-value" id="taeg">-</div>
            <div class="result-formula">Taxa Anual Efetiva Global</div>
          </div>

          <table class="summary-table" style="display: none" id="summaryTable">
            <thead>
              <tr>
                <th>Resumo Financeiro</th>
                <th>Valor</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Montante Solicitado</td>
                <td id="summaryMontante">-</td>
              </tr>
              <tr>
                <td>Montante com Comiss√£o</td>
                <td id="summaryMontanteComissao">-</td>
              </tr>
              <tr>
                <td>Total a Pagar</td>
                <td id="summaryTotal">-</td>
              </tr>
              <tr>
                <td>Total de Juros</td>
                <td id="summaryJuros">-</td>
              </tr>
              <tr>
                <td>Prazo em Anos</td>
                <td id="summaryAnos">-</td>
              </tr>
              <tr>
                <td>Status da Aprova√ß√£o</td>
                <td id="summaryStatus">-</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      // Mostrar/esconder campo personalizado
      document
        .getElementById('limiteTaxaEsforco')
        .addEventListener('change', function () {
          const customGroup = document.getElementById('customLimitGroup');
          if (this.value === 'custom') {
            customGroup.style.display = 'block';
          } else {
            customGroup.style.display = 'none';
          }
          calcular();
        });

      function calcular() {
        // Obter valores dos inputs
        const montante =
          parseFloat(document.getElementById('montante').value) || 0;
        const taxaAnual =
          parseFloat(document.getElementById('taxa').value) || 0;
        const prazo = parseInt(document.getElementById('prazo').value) || 0;
        const comissao =
          parseFloat(document.getElementById('comissao').value) || 0;
        const rendimento =
          parseFloat(document.getElementById('rendimento').value) || 0;

        // Obter limite da taxa de esfor√ßo
        const limiteTaxaSelect =
          document.getElementById('limiteTaxaEsforco').value;
        let limiteTaxaEsforco;

        if (limiteTaxaSelect === 'custom') {
          limiteTaxaEsforco =
            parseFloat(document.getElementById('customLimit').value) || 35;
        } else {
          limiteTaxaEsforco = parseFloat(limiteTaxaSelect);
        }

        // Valida√ß√µes
        if (montante <= 0 || taxaAnual <= 0 || prazo <= 0 || rendimento <= 0) {
          alert('Por favor, preencha todos os campos com valores v√°lidos.');
          return;
        }

        // C√°lculos
        const taxaMensal = taxaAnual / 12 / 100;
        const prestacao = calcularPrestacao(montante, taxaMensal, prazo);
        const taxaEsforco = (prestacao / rendimento) * 100;
        const montanteComComissao = montante * (1 - comissao / 100);
        const taeg = calcularTAEG(prestacao, prazo, montanteComComissao) * 100;

        // Atualizar resultados na tela
        document.getElementById('taxaMensal').textContent =
          (taxaMensal * 100).toFixed(3) + '%';
        document.getElementById('prestacao').textContent =
          formatarMoeda(prestacao);
        document.getElementById('taxaEsforco').textContent =
          taxaEsforco.toFixed(1) + '%';
        document.getElementById('taeg').textContent = taeg.toFixed(3) + '%';
        document.getElementById('limiteAtual').textContent = limiteTaxaEsforco;

        // Resumo financeiro
        const totalPagar = prestacao * prazo;
        const totalJuros = totalPagar - montante;
        const prazoAnos = prazo / 12;

        document.getElementById('summaryMontante').textContent =
          formatarMoeda(montante);
        document.getElementById('summaryMontanteComissao').textContent =
          formatarMoeda(montanteComComissao);
        document.getElementById('summaryTotal').textContent =
          formatarMoeda(totalPagar);
        document.getElementById('summaryJuros').textContent =
          formatarMoeda(totalJuros);
        document.getElementById('summaryAnos').textContent =
          prazoAnos.toFixed(1) + ' anos';

        // Determinar status da aprova√ß√£o
        let status, statusClass, statusText;
        const taxaEsforcoCard = document.getElementById('taxaEsforcoCard');
        const statusIndicator = document.getElementById('statusIndicator');

        if (taxaEsforco <= limiteTaxaEsforco) {
          status = 'success';
          statusClass = 'status-approved';
          statusText = '‚úÖ Pr√©-Aprovado';
          taxaEsforcoCard.className = 'result-card success';
        } else if (taxaEsforco <= limiteTaxaEsforco + 5) {
          status = 'warning';
          statusClass = 'status-review';
          statusText = '‚ö†Ô∏è An√°lise Necess√°ria';
          taxaEsforcoCard.className = 'result-card warning';
        } else {
          status = 'danger';
          statusClass = 'status-rejected';
          statusText = 'üö´ Rejeitado';
          taxaEsforcoCard.className = 'result-card warning';
        }

        statusIndicator.innerHTML = `<span class="status-indicator ${statusClass}">${statusText}</span>`;
        document.getElementById('summaryStatus').innerHTML =
          `<span class="status-indicator ${statusClass}">${statusText}</span>`;

        // Mostrar tabela de resumo
        document.getElementById('summaryTable').style.display = 'table';

        // Mostrar alertas apropriados
        document
          .getElementById('alertDanger')
          .classList.toggle('show', status === 'danger');
        document
          .getElementById('alertWarning')
          .classList.toggle('show', status === 'warning');
        document
          .getElementById('alertSuccess')
          .classList.toggle('show', status === 'success');
      }

      function calcularPrestacao(montante, taxaMensal, prazo) {
        // F√≥rmula: PMT = P * [r(1+r)^n] / [(1+r)^n - 1]
        const fator = Math.pow(1 + taxaMensal, prazo);
        return (montante * (taxaMensal * fator)) / (fator - 1);
      }

      function calcularTAEG(prestacao, prazo, montanteComComissao) {
        // Aproxima√ß√£o da TAEG usando m√©todo iterativo simples
        let taxa = 0.01; // Taxa inicial de 1%
        let tentativas = 0;
        const maxTentativas = 1000;
        const precisao = 0.01;

        while (tentativas < maxTentativas) {
          const taxaMensal = taxa / 12;
          const prestacaoCalculada = calcularPrestacao(
            montanteComComissao,
            taxaMensal,
            prazo
          );
          const diferenca = Math.abs(prestacaoCalculada - prestacao);

          if (diferenca < precisao) {
            return taxa;
          }

          if (prestacaoCalculada > prestacao) {
            taxa -= 0.0001;
          } else {
            taxa += 0.0001;
          }

          tentativas++;
        }

        return taxa;
      }

      function formatarMoeda(valor) {
        return new Intl.NumberFormat('pt-CV', {
          style: 'currency',
          currency: 'CVE',
          minimumFractionDigits: 0,
          maximumFractionDigits: 0,
        }).format(valor);
      }

      // Calcular automaticamente quando a p√°gina carrega
      window.onload = function () {
        calcular();
      };

      // Calcular automaticamente quando os valores mudam
      document.querySelectorAll('input, select').forEach((element) => {
        element.addEventListener('input', calcular);
        element.addEventListener('change', calcular);
      });
    </script>
  </body>
</html>
